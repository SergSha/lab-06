<?php
// Add a car to database
if (isset($_POST["tb"]) && isset($_POST["name"]) && isset($_POST["year"]) && isset($_POST["price"])) {
     
    $tb = $_POST["tb"];
    try {
        $connect_data = "host={{ ip_address['db-01'] }} port=5432 dbname=cars user=postgres password=zalando";
        $db_connect = pg_connect($connect_data);
        //$conn = new PDO("mysql:host={{ ip_address['proxysql-01'] }};port=6033;dbname={{ db_name }}", "{{ mysql_php_user }}", "{{ mysql_php_password }}");
        $sql = "INSERT INTO $tb (name, year, price) VALUES (:name, :year, :price)";
        // определяем prepared statement
        $stmt = $db_connect->prepare($sql);
        // привязываем параметры к значениям
        //$stmt->bindValue(":tb", $_POST["tb"]);
        $stmt->bindValue(":name", $_POST["name"]);
        $stmt->bindValue(":year", $_POST["year"]);
        $stmt->bindValue(":price", $_POST["price"]);
        // выполняем prepared statement
        $affectedRowsNumber = $stmt->execute();
        // если добавлена как минимум одна строка
        //if($affectedRowsNumber > 0 ){
            //echo "Data successfully added: tb=" . $_POST["tb"] . "  name=" . $_POST["name"] . "  year=" . $_POST["year"] . "  price=" . $_POST["price"];
        //}
        //$db_connect = null;
        header("Location: index.php");
    }
    catch (PDOException $e) {
        echo "Database error: " . $e->getMessage();
    }
}
?>

